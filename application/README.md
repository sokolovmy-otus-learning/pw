# Сервис сокращения ссылок

Лёгкий и масштабируемый сервис для сокращения URL, построенный на FastAPI, Redis и Nginx. Имеет современный интерфейс в стиле Google, который адаптируется к светлой или тёмной теме системы.

## Возможности

- **Сокращение ссылок**: Создание коротких 6-символьных URL (base62) из длинных ссылок.
- **Редирект**: Перенаправление с коротких ссылок на оригинальные URL.
- **Информация о ссылке**: Получение данных о короткой ссылке, включая оригинальный URL и время жизни (TTL).
- **Управление TTL**: Ссылки истекают через заданное время (по умолчанию 24 часа), TTL обновляется при обращении.
- **Адаптивный дизайн**: Интерфейс с чистым дизайном в стиле Google, использующий Tailwind CSS и шрифт Roboto, поддерживает светлую и тёмную темы в зависимости от настроек системы.
- **Масштабируемая архитектура**: Контейнеризировано с помощью Docker, использует FastAPI для API, Redis для хранения данных и Nginx для обслуживания статических файлов и проксирования запросов.

## Структура проекта

```
url-shortener/
├── link_service/               # Сервис API для создания и получения коротких ссылок
│   ├── Dockerfile
│   ├── main.py
│   ├── requirements.txt
├── redirect_service/           # Сервис для обработки редиректов
│   ├── Dockerfile
│   ├── main.py
│   ├── requirements.txt
├── redis/                      # Конфигурация Redis
│   ├── redis.conf
├── nginx/                      # Конфигурация Nginx
│   ├── nginx.conf
├── frontend/                   # Статические файлы фронтенда
│   ├── index.html
├── docker-compose.yml          # Конфигурация Docker Compose
├── README.md                   # Этот файл
```

## Требования

- Установленные **Docker** и **Docker Compose**.
- Доступ в интернет для загрузки Docker-образов и шрифтов Google Fonts.

## Установка

1. **Клонируйте репозиторий**:
   ```bash
   git clone <url-репозитория>
   cd url-shortener
   ```

2. **Проверьте структуру проекта**, чтобы она соответствовала указанной выше.

3. **Соберите и запустите сервисы**:
   ```bash
   docker-compose up --build
   ```
   Это:
   - Соберёт образы для `link-service` и `redirect-service`.
   - Загрузит образы `redis:7.4` и `nginx:1.26.0`.
   - Запустит все сервисы (Nginx, FastAPI API, Redis) в сетевом мосту.

4. **Откройте приложение**:
   - Перейдите по адресу `http://localhost` в браузере.
   - Интерфейс автоматически адаптируется к системной теме (светлой или тёмной, например, Windows: Параметры → Персонализация → Цвета).

## Использование

### Веб-интерфейс
1. **Сокращение ссылки**:
   - Введите действительный URL (например, `https://example.com`) в поле ввода.
   - Нажмите кнопку "Shorten URL".
   - Появится короткая ссылка (например, `http://localhost/AbCdEf`), на которую можно кликнуть или ее скопировать.
2. **Копирование короткой ссылки**:
   - Нажмите на иконку копирования рядом с короткой ссылкой, чтобы скопировать её в буфер обмена.
3. **Редирект**:
   - Перейдите по короткой ссылке (например, `http://localhost/AbCdEf`), чтобы попасть на оригинальный URL.
4. **Обработка ошибок**:
   - При вводе некорректного URL или сбое отображается сообщение об ошибке красным цветом.

### API
Сервис `link-service` предоставляет два endpoint'а под `/api/`:
- **POST `/api/shorten`**:
  - Запрос: `{"url": "https://example.com"}`
  - Ответ: `{"shortId": "AbCdEf", "shortUrl": "/AbCdEf"}`
  - Пример:
    ```bash
    curl -X POST http://localhost/api/shorten -H "Content-Type: application/json" -d '{"url":"https://example.com"}'
    ```
- **GET `/api/links/{shortId}`**:
  - Ответ: `{"shortId": "AbCdEf", "originalUrl": "https://example.com", "ttl": 86399, "prettyTtl": "23 hours, 59 minutes, 59 seconds"}`
  - Пример:
    ```bash
    curl http://localhost/api/links/AbCdEf
    ```

Сервис `redirect-service` обрабатывает:
- **GET `/{shortId}`**:
  - Перенаправляет на оригинальный URL, хранящийся в Redis.
  - Обновляет TTL при обращении.
  - Пример:
    ```bash
    curl -v http://localhost/AbCdEf
    ```

## Конфигурация

- **Переменные окружения** (указаны в `docker-compose.yml`):
  - `LINK_TTL_SECONDS`: Время жизни ссылок (по умолчанию: 86400 секунд = 24 часа).
  - `UVICORN_WORKERS`: Количество воркеров Uvicorn (по умолчанию: 4).
  - `ROOT_PATH`: Префикс API для `link-service` (по умолчанию: `/api`).
  - `PORT`: Порт для сервисов (3000 для `link-service`, 3001 для `redirect-service`).
- **Redis**:
  - Настроен в `redis/redis.conf` с использованием append-only file (AOF) и RDB-снимков для сохранности данных.
  - Данные хранятся в Docker-томе (`redis-data`).
- **Nginx**:
  - Обслуживает фронтенд из `/usr/share/nginx/html`.
  - Проксирует запросы `/api/` к `link-service` и короткие ссылки (`/[a-zA-Z0-9]{6}`) к `redirect-service`.

## Настройка

### Фронтенд
- **Тема**:
  - Интерфейс использует палитру Google (`#4285F4`, `#FBBC05`, `#EA4335`) и шрифт **Roboto**.
  - Светлая тема: фон `#F1F3F4`, белый контейнер.
  - Тёмная тема: фон `#202124`, контейнер `#303134`.
  - Измените `frontend/index.html` для настройки цветов или добавления функций.
- **Ширина**:
  - Измените `w-[90%]` в `index.html` для настройки ширины контейнера (например, `w-[80%]`).
- **Иконка страницы**:
  - Измените SVG в `<link rel="icon">` для смены иконки или цвета (`stroke='%234285F4'`).

### Бэкенд
- **TTL**:
  - Измените `LINK_TTL_SECONDS` в `docker-compose.yml` для настройки времени жизни (например, `172800` для 48 часов).
- **Длина shortId**:
  - Измените функцию `generate_short_id` в `link_service/main.py` для изменения длины (например, 8 символов).

## Разработка

Для внесения изменений и тестирования:
1. Обновите файлы (например, `index.html`, `main.py`).
2. Пересоберите и перезапустите:
   ```bash
   docker-compose down
   docker-compose up --build
   ```
3. Отладка:
   - Просмотрите логи: `docker-compose logs <сервис>` (например, `link-service`, `nginx`).
   - Проверьте Redis: `docker exec -it <redis-контейнер> redis-cli`.
   - Используйте DevTools браузера для проблем с фронтендом.

## Замечания
- **Безопасность**: Для продакшена добавьте HTTPS (например, через Let's Encrypt) и пароль для Redis.
- **Производительность**: Увеличьте `UVICORN_WORKERS` для высокой нагрузки или настройте `appendfsync` в Redis для оптимизации.
- **Сохранность данных**: Данные Redis хранятся в томе `redis-data` и сохраняются между перезапусками.

## Лицензия
MIT License. Используйте и модифицируйте свободно.